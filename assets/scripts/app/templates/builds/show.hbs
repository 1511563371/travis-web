{{#if loading}}
  <span>Loading</span>
{{else}}
  <div id="new-summary">
    <div class="right">
      <div class="build-status">
        #{{build.number}} {{build.state}}
      </div>

      <div class="runtime">
         ran for {{formatDuration build.duration}} 
      </div>

      <div class="finished">
        {{formatTime build.finishedAt}}
      </div>
    </div>
 
    <div class="branch" {{bind-attr title="build.commit.branch"}}>
      {{build.commit.branch}}
    </div>
    -
    <div class="subject">
      {{formatMessage build.commit.subject repoBinding=build.repo}}
    </div>

    <pre class="body">
{{formatMessage build.commit.body repoBinding=build.repo pre=true}}
    </pre>

    <div class="footer">
      <div class="author">
        {{#if commit.authorName}}
          <img src="https://travis-ci.org/images/mailer/mascot-avatar-40px.png"/>{{commit.authorName}} authored
        {{/if}}
        {{#if commit.committerName}}
          <img src="https://travis-ci.org/images/mailer/mascot-avatar-40px.png"/>{{commit.committerName}} committed
        {{/if}}
      </div>

      <div class="commit">
        <a class="github" {{bind-attr href="controller.urlGithubCommit"}}>Commit {{formatSha commit.sha}}</a><img src="/images/icons/github.png" height="15"/>
        {{#if build.pullRequest}}
          <a {{bind-attr href="build.commit.compareUrl"}} >#{{build.pullRequestNumber}}: {{build.pullRequestTitle}}</a> {{else}}
          {{#if build.commit.compareUrl}}
            <a {{bind-attr href="build.commit.compareUrl"}}>Compare {{pathFrom build.commit.compareUrl}}</a>
          {{/if}}
        {{/if}}
        <img src="/images/icons/github.png" height="15"/>
      </div>
    </div>
  </div>

  <dl id="summary">
    <div class="left">
      <dt>Build</dt>
      <dd class="number">
        <span class="status"></span>
        {{#if build.id}}
          {{#if build.repo.slug}}
            {{#link-to "build" repo build}}{{build.number}}{{/link-to}}
          {{/if}}
        {{/if}}
      </dd>
      <dt>State</dt>
      <dd class="state">{{capitalize build.state}}</dd>
      <dt class="finished_at_label">Finished</dt>
      <dd class="finished_at timeago" {{bind-attr title="build.formattedFinishedAt"}}>{{formatTime build.finishedAt}}</dd>
      <dt>Duration</dt>
      <dd class="duration" {{bind-attr title="startedAt"}}>{{formatDuration build.duration}}</dd>
    </div>

    {{#with build}}
      <div class="right">
        <dt>Commit</dt>
        <dd class="commit"><a {{bind-attr href="controller.urlGithubCommit"}}>{{formatCommit commit}}</a></dd>
        {{#if pullRequest}}
          <dt>Pull Request</dt>
          <dd class="pull_request"><a {{bind-attr href="commit.compareUrl"}}>#{{pullRequestNumber}} {{pullRequestTitle}}</a></dd>
        {{else}}
          {{#if commit.compareUrl}}
            <dt>Compare</dt>
            <dd class="compare"><a {{bind-attr href="commit.compareUrl"}}>{{pathFrom commit.compareUrl}}</a></dd>
          {{/if}}
        {{/if}}
        {{#if commit.authorName}}
          <dt>Author</dt>
          <dd class="author">{{commit.authorName}}</dd>
        {{/if}}
        {{#if commit.committerName}}
          <dt>Committer</dt>
          <dd class="committer">{{commit.committerName}}</dd>
        {{/if}}
      </div>
    {{/with}}


    <dt>Message</dt>
    <dd class="message">
      {{formatMessage build.commit.subject repoBinding=build.repo}}
      <pre class="body">{{formatMessage build.commit.body repoBinding=build.repo pre=true}}</pre>
    </dd>
  </dl>

  {{#unless build.isMatrix}}
    {{view Travis.AnnotationsView annotationsBinding="build.jobs.firstObject.annotations"}}
  {{/unless}}

  {{#if build.isMatrix}}
    {{view Travis.JobsView jobsBinding="build.requiredJobs" required="true"}}
    {{view Travis.JobsView jobsBinding="build.allowedFailureJobs"}}
  {{else}}
    {{view Travis.LogView jobBinding="build.jobs.firstObject"}}
  {{/if}}
{{/if}}
